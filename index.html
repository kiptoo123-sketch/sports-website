 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Betika-Style Predictor</title>
<style>
  body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
  h1, h2 { text-align:center; }
  #login-section { text-align:center; margin-bottom:20px; }
  button { padding:8px 15px; margin:5px; cursor:pointer; }
  .match-card { background:#fff; padding:10px; margin:10px 0; border-radius:6px; box-shadow:0 0 5px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
  .match-info { flex:1; margin-left:10px; }
  select { padding:5px; }
  table { width:100%; border-collapse: collapse; margin-top:10px; background:#fff; border-radius:6px; overflow:hidden; }
  th, td { padding:8px; text-align:center; border-bottom:1px solid #ddd; }
  th { background:#eee; }
  img.team-logo { height:30px; width:30px; vertical-align:middle; margin-right:5px; }
</style>
</head>
<body>

<h1>Betika-Style Predictor</h1>

<div id="login-section">
  <button id="login-btn">Login with Google</button>
  <button id="logout-btn" style="display:none;">Logout</button>
</div>

<div id="user-info" style="text-align:center;"></div>

<div id="matches">
  <h2>Matches</h2>
  <div id="matches-container"></div>
</div>

<div id="leaderboard">
  <h2>Leaderboard</h2>
  <table id="leaderboard-table">
    <thead>
      <tr><th>User</th><th>Points</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.2/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.2/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.6.2/firebase-firestore.js";

// --- Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyDyqTVq8hDjWatJBG4uVgTGaPA6TZ5yA_s",
  authDomain: "betika-style-predictor.firebaseapp.com",
  projectId: "betika-style-predictor",
  storageBucket: "betika-style-predictor.firebasestorage.app",
  messagingSenderId: "1081822274358",
  appId: "1:1081822274358:web:cfd0d79f9d1c6e5fd68997"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");
const userInfo = document.getElementById("user-info");
const matchesContainer = document.getElementById("matches-container");
const leaderboardBody = document.querySelector("#leaderboard-table tbody");

let currentUser = null;

// --- Leagues ---
const leagues = [
  { name: "Premier League", id: 4328 },
  { name: "La Liga", id: 4335 },
  { name: "Bundesliga", id: 4331 },
  { name: "Serie A", id: 4332 },
  { name: "Ligue 1", id: 4334 }
];

// --- Load matches ---
async function loadMatches() {
  matchesContainer.innerHTML = "<p>Loading matches...</p>";
  let allMatches = [];

  for (const league of leagues) {
    try {
      const res = await fetch("https://api.allorigins.win/raw?url=" +
        encodeURIComponent(`https://www.thesportsdb.com/api/v1/json/50f522f5ff34de0a7224a773578c6509/eventsnextleague.php?id=${league.id}`)
      );
      const data = await res.json();
      if(data.events){
        const leagueMatches = data.events.map((event,index)=>({
          id:`${league.id}-${index+1}`,
          league: league.name,
          home: event.strHomeTeam,
          away: event.strAwayTeam,
          homeLogo: event.strHomeTeamBadge || "",
          awayLogo: event.strAwayTeamBadge || "",
          date: event.dateEvent,
          time: event.strTime
        }));
        allMatches = allMatches.concat(leagueMatches);
      }
    } catch(err) {
      console.error("Failed to load league", league.name, err);
    }
  }

  displayMatches(allMatches);
}

function displayMatches(matches){
  matchesContainer.innerHTML = "";
  matches.forEach(match=>{
    const div = document.createElement("div");
    div.className = "match-card";
    div.innerHTML = `
      <div><b>${match.league}</b></div>
      <div class="match-info">
        <img src="${match.homeLogo}" class="team-logo">${match.home} 
        vs 
        <img src="${match.awayLogo}" class="team-logo">${match.away}
        <br><small>${match.date} ${match.time}</small>
      </div>
      <div>
        <select id="pred-${match.id}">
          <option value="">Predict</option>
          <option value="Home">Home</option>
          <option value="Draw">Draw</option>
          <option value="Away">Away</option>
        </select>
        <button onclick="submitPrediction('${match.id}','${match.home} vs ${match.away}')">Submit</button>
      </div>
    `;
    matchesContainer.appendChild(div);
  });
}

// --- Submit prediction ---
window.submitPrediction = async (matchId, matchName)=>{
  if(!currentUser) return alert("Login first!");
  const sel = document.getElementById(`pred-${matchId}`);
  const prediction = sel.value;
  if(!prediction) return alert("Select a prediction");
  await addDoc(collection(db,"predictions"),{
    user: currentUser.displayName,
    matchId,
    matchName,
    prediction,
    timestamp: Date.now()
  });
  alert("Prediction saved!");
};

// --- Leaderboard ---
const q = query(collection(db,"predictions"),orderBy("timestamp","desc"));
onSnapshot(q,snapshot=>{
  const map={};
  snapshot.docs.forEach(doc=>{
    const d=doc.data();
    map[d.user]=(map[d.user]||0)+1;
  });
  const data=Object.keys(map).map(u=>({user:u,points:map[u]}));
  leaderboardBody.innerHTML = "";
  data.forEach(item=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${item.user}</td><td>${item.points}</td>`;
    leaderboardBody.appendChild(tr);
  });
});

// --- Authentication ---
loginBtn.onclick = ()=> signInWithPopup(auth,provider).catch(e=>alert(e.message));
logoutBtn.onclick = ()=> signOut(auth);

onAuthStateChanged(auth,user=>{
  currentUser = user;
  if(user){
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    userInfo.innerHTML=`Logged in as <b>${user.displayName}</b>`;
  } else{
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    userInfo.innerHTML="";
  }
});

// --- Start ---
loadMatches();

</script>

</body>
</html>
