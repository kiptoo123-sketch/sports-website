<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Betika-style Predictor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    header {
      background: #1e3a8a;
      color: white;
      padding: 20px;
      text-align: center;
    }

    header button {
      margin-left: 10px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }

    main {
      max-width: 800px;
      margin: 20px auto;
      padding: 0 15px;
    }

    section {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    h2 {
      margin-top: 0;
    }

    #matches-list button {
      margin-top: 5px;
      padding: 5px 10px;
      cursor: pointer;
    }

    footer {
      text-align: center;
      padding: 10px;
      background: #1e3a8a;
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <h1>âš½ Betika-style Predictor</h1>
    <button id="login-btn">Login with Google</button>
    <button id="logout-btn" hidden>Logout</button>
  </header>

  <main>
    <section id="matches">
      <h2>Upcoming Matches</h2>
      <div id="matches-list">Loading matches...</div>
    </section>

    <section id="predictions">
      <h2>Your Predictions</h2>
      <div id="user-predictions">No predictions yet.</div>
    </section>

    <section id="leaderboard">
      <h2>Leaderboard</h2>
      <ol id="leaderboard-list">
        <li>Loading...</li>
      </ol>
    </section>
  </main>

  <footer>
    <p>Powered by Firebase & GitHub Pages</p>
  </footer>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, onSnapshot, query } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDyqTVq8hDjWatJBG4uVgTGaPA6TZ5yA_s",
      authDomain: "betika-style-predictor.firebaseapp.com",
      projectId: "betika-style-predictor",
      storageBucket: "betika-style-predictor.firebasestorage.app",
      messagingSenderId: "1081822274358",
      appId: "1:1081822274358:web:cfd0d79f9d1c6e5fd68997"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // DOM elements
    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const matchesList = document.getElementById("matches-list");
    const userPredictions = document.getElementById("user-predictions");
    const leaderboardList = document.getElementById("leaderboard-list");

    // Example matches (replace with real API later)
    const matches = [
      { id: "m1", home: "Team A", away: "Team B", time: "Today 18:00" },
      { id: "m2", home: "Team C", away: "Team D", time: "Today 20:00" },
    ];

    function displayMatches() {
      matchesList.innerHTML = "";
      matches.forEach(match => {
        const div = document.createElement("div");
        div.innerHTML = `
          <strong>${match.home} vs ${match.away}</strong> - ${match.time}
          <br>
          <button onclick="predict('${match.id}')">Predict Win</button>
        `;
        matchesList.appendChild(div);
      });
    }

    loginBtn.addEventListener("click", () => signInWithPopup(auth, provider));
    logoutBtn.addEventListener("click", () => signOut(auth));

    onAuthStateChanged(auth, user => {
      if (user) {
        loginBtn.hidden = true;
        logoutBtn.hidden = false;
        displayMatches();
        loadPredictions(user.uid);
        loadLeaderboard();
      } else {
        loginBtn.hidden = false;
        logoutBtn.hidden = true;
        matchesList.innerHTML = "Please login to see matches.";
        userPredictions.innerHTML = "No predictions yet.";
        leaderboardList.innerHTML = "<li>Login to see leaderboard</li>";
      }
    });

    window.predict = async function(matchId) {
      const user = auth.currentUser;
      if (!user) return alert("Login first");

      const score = prompt("Enter your predicted score (e.g., 2-1):");
      if (!score) return;

      await addDoc(collection(db, "predictions"), {
        userId: user.uid,
        matchId,
        score,
        timestamp: Date.now()
      });

      loadPredictions(user.uid);
      alert("Prediction saved!");
    };

    async function loadPredictions(uid) {
      const snapshot = await getDocs(collection(db, "predictions"));
      const userDocs = snapshot.docs.filter(d => d.data().userId === uid);
      userPredictions.innerHTML = userDocs.length 
        ? "<ul>" + userDocs.map(d => `<li>${d.data().matchId}: ${d.data().score}</li>`).join("") + "</ul>" 
        : "No predictions yet.";
    }

    function loadLeaderboard() {
      const predictionsCol = collection(db, "predictions");
      const q = query(predictionsCol);
      onSnapshot(q, snapshot => {
        const counts = {};
        snapshot.docs.forEach(doc => {
          const data = doc.data();
          counts[data.userId] = (counts[data.userId] || 0) + 1;
        });
        leaderboardList.innerHTML = "";
        Object.entries(counts)
          .sort((a,b) => b[1]-a[1])
          .forEach(([uid, score]) => {
            const li = document.createElement("li");
            li.textContent = `User: ${uid} - Predictions: ${score}`;
            leaderboardList.appendChild(li);
          });
      });
    }
  </script>
</body>
</html>
